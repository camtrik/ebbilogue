---
title: 通过PSN API获取PSN奖杯信息
date: '2025-02-01'
lastmod: '2025-02-02'
tags: ['Web', 'Game']
draft: false
summary: PSN API的用法记录
images:
  [
    'https://res.cloudinary.com/camtrik/image/upload/v1738572135/%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88_2025-02-03_164150_caqufb.png',
  ]
layout: 'PostBannerInfo'
---

想在主页加一个奖杯展示页面，发现PSN没有官方公开的API，但Github上有爬取获得的民间文档。

主要参考:  
[PlayStation-Trophies](https://github.com/andshrew/PlayStation-Trophies)  
[psn-api-javascript](https://github.com/achievements-app/psn-api)

文档是比较全面的，这里简洁记录一下获取奖杯的主要流程

[效果页](/gaming)

## 获取授权

### 获取NPSSO

- 访问[Playstation homepage](https://www.playstation.com/)，登录。
- 同一个浏览器，访问[这里](https://ca.account.sony.com/api/v1/ssocookie)，看到JSON：

```
{ "npsso": "<64 character token>" }
```

复制npsso的值，以供后续使用。

### 获取Access Code

```
curl -i -X GET \
'https://ca.account.sony.com/api/authz/v3/oauth/authorize?access_type=offline&client_id=09515159-7237-4370-9b40-3806e67c0891&redirect_uri=com.scee.psxandroid.scecompcall://redirect&response_type=code&scope=psn:mobile.v2.core%20psn:clientapp' \
-H 'Cookie: npsso=YOUR_NPSSO_TOKEN' \
-H 'Accept: application/json' \
--max-redirs 0
```

access code在返回的Location字段中：

```
Location: com.scee.psxandroid.scecompcall://redirect/?code='YOUR_ACCESS_CODE'&cid=xxxxxxx
```

### 获取Access Token & Refresh Token

```
curl -X POST 'https://ca.account.sony.com/api/authz/v3/oauth/token' \
-H 'Content-Type: application/x-www-form-urlencoded' \
-H 'Authorization: Basic MDk1MTUxNTktNzIzNy00MzcwLTliNDAtMzgwNmU2N2MwODkxOnVjUGprYTV0bnRCMktxc1A=' \
--data-urlencode 'code=YOUR_ACCESS_CODE' \
--data-urlencode 'redirect_uri=com.scee.psxandroid.scecompcall://redirect' \
--data-urlencode 'grant_type=authorization_code' \
--data-urlencode 'token_format=jwt'
```

即会返回Access Token和Refresh token

由于access token会很快过期，在实际获取奖杯List时，先用Refresh Token交换Access Token

## 获取奖杯List

### 使用Refresh Token更新Access Token

```
curl -X POST 'https://ca.account.sony.com/api/authz/v3/oauth/token' \
-H 'Content-Type: application/x-www-form-urlencoded' \
-H 'Authorization: Basic MDk1MTUxNTktNzIzNy00MzcwLTliNDAtMzgwNmU2N2MwODkxOnVjUGprYTV0bnRCMktxc1A=' \
--data-urlencode 'refresh_token=YOUR_REFRESH_TOKEN' \
--data-urlencode 'grant_type=refresh_token' \
--data-urlencode 'token_format=jwt' \
--data-urlencode 'scope=psn:mobile.v2.core psn:clientapp'
```

之后只用到`access_token`字段

### 获取所有奖杯

```
curl -X GET 'https://m.np.playstation.com/api/trophy/v1/users/USER_ACCOUNT_ID/trophyTitles' \
-H 'Authorization: Bearer YOUR_ACCESS_TOKEN' \
-H 'Accept: application/json'
```

curl -X GET 'https://m.np.playstation.com/api/trophy/v1/users/me/trophyTitles' \
-H 'Authorization: Bearer eyJraWQiOiJucF8xIiwiYWxnIjoiUlMyNTYifQ.eyJhY2NvdW50X2lkIjoiNTM2Njk1OTIxOTIzMjE0NzEwOSIsImFjY291bnRfdXVpZCI6ImNjMDQxZTZmLTJhNjUtNDc3Mi05ZWI3LWUwNmE1ZGI3ZWFjNiIsImFnZSI6MjQsImF1dGh6X2MiOiJlTnFWVlZGdTVEWU12WXFSQXhqWTlrOS8zU2thRkdpS3hjNEJESTFNMjJ4a1NSQnBKOTZpZHk4bDJSNW5NdGx0djJ3OVBwTVUrVWovL1VER0IzaFFEMFk3WmZ3NGF0ZldFMEdzZStEcUhVZzc2QmhlK1paNUFBdVR0Zlc5WW1RTDlQbFVtSUZJb1p1UklaOWJtTkdBU3Evd0dxeVA4cTVIb1BxSUVQdUlLNWFzVDlDaVBrUE1ueHJycHpZamo5cGFpTXNITk8vSVd3bXFSM1Q5SDM1eVBkUlRhRFZEZGNRZW81OENxWHlMMFYvUXd1YnZlNVIwM3dGc09DL0VNS3JEaDlnMjdKL0JLZDFPbHBzWkluWW9wVUh2R21MTkV4MG9QVndQRjR3ODVQUjJLSmZZY1dNNDJpdUsxSmdCYlh0RnZMUG9vRUdCM0tNVTRoZkRLQldYRW02WnpRZ3ZZbVN3Rm50d0JyNVl6WjJQb3dxZmZuWWw4WHRXZ242VURIWkNCT0tURGp4Smx3NmxlTmFqL2d1VjBaR2J5N1E0LzNJSGFrS0VuTWZSZEl1Si9DQWFhSnhVYklZTlR0MXRMTkllU2ZKcGNqNU8yMFlTVEpKTGlkSkdTT1Q5RUZ1YmIzQTRraGxBR2dSSGJGWEhpa3pSN3RsWnYyakxTNVpBNWVDRmZnTm9WVTVBbTlSYXFpMCtRK1gxeElQU0lVUS9RNU1Pcm1FMHp4SzdtQ0xvOWdZUDRLUnh3ZW9GNGxmSUJYQnQxZ3VwZ3BaQkNDUkRWOGJuZDlmNUxkc01wN3krUk9pa1A5SzlxMGtrWkZIS0lobmwwNmFHbjJvamMxYUZpWVkvUGU4Q1ZTOXdPZnVVMXFaelVhQUR3OVh1KzFjWjh1dUlUWTdqY3ZLdXc3NU9WNnNpbTg4UjJ4N1U3SVZ5R2pUdlBraDNJRFZjUlYxcmFkM3lEU3E2NkdIUFRDUW9mUlNuOWFCcHFNaEVBRWVERnJubFJoRG9hQWExcnBwY2x4VWliMURiRlNHUzJ6eEpoQjZpQ3FLejVWeXdtdkxBYmhXNlplWnkzMUFQcy8wLzZIc0FadGtqcEh6WG5kYU5WS1M5T3Z6UUhDWXhUeGVwQUlZaUJsK2U1Y01jN0VsQ1N5WnFMTTg2N1Jjb0MzbUxmNWUzNzNFMkpDT2V1MW1MUm1vcGQvb3F3V1d0bHp0dGNQUmhXSlNXN1FOekhyZGpjVlpyQ3gwNlRKbmVNWWFJc3piTEhVc0tkeTdWK0cvVzlZS1RFL1ZDdTI2ODVjbW5vWDZ6OVlReHc2dVNmNHVzNHJ3anN1ZmtVcTZTTlZ4cjVvaVhpZVdmTTJ1THhmTWJnb3hzV2pObFRpU0hGdDU3U2JNcjBWYk9EOHhiL2g4eXZzcXFqWmkzeXpuL045NTdmQWRzZXFxM1FtK01OMVB1RG9jN212aytmOWRPMlRtK2swSy9FY3VoZXorZ2xIZ1AvL3dMMld4VXNnIiwiY2xpZW50X2lkIjoiMDk1MTUxNTktNzIzNy00MzcwLTliNDAtMzgwNmU2N2MwODkxIiwiZGNpbV9pZCI6ImNlMmZlODJkLTJjOWUtNGI1OC05Y2JmLWM1OWZjM2E4NmU0NSIsImVudl9pc3NfaWQiOiIyNTYiLCJleHAiOjE3Mzg3NjU2MTAsImdyYW50X3R5cGUiOiJhdXRob3JpemF0aW9uX2NvZGUiLCJpYXQiOjE3Mzg3NjIwMTAsImlzX2NoaWxkIjpmYWxzZSwiaXNzIjoiaHR0cHM6Ly9hdXRoLmFjY291bnQuc29ueS5jb20vIiwianRpIjoiYTQ0YTg2OWEtNTc1Mi00ZmE4LWI0YTItZmUyMWU0YTc4ODhlIiwibGVnYWxfY291bnRyeSI6IkhLIiwibG9jYWxlIjoiemgtSGFucyIsInVzZXJfZGV2aWNlX2lwIjoiMTIxLjIyNi4xNjkuMjAiLCJ2ZXIiOiIyIn0.a6KfxkWReNevBkfO3psUzcqkLkvT4vb6c_bfhXZBUcWqMMdfu-vBeWk5GXDyiNBGRqbmphzzLtd-fCyE_XZkUrBIxOqVnlndkQOp-63orj7E491m9FcAfkK1h4BscbvVVpVzm3Rv8gGPy-JZ6A97P0UGAeVAbWXOd4PzJiyKCg7VBI1tVY8MwQ0L1stxFBJNUoqLFaYNnDqZnSHSZqpp7bT01tHNT_aE5bY82rzz1H6NfCgidsnAGRF5Vzl_uKM9JPn1h9QvxBKn73ceUUg8kpF8SWPYQFtWd5EOdKj0XCdIKBPBP-QrRI8oFwi_wIgL_raWRCylTRnwe8oE_R3D9iAJ-DkjgKcBZLt4SVrFGYt_LdSharDYqmJtlQSqfw7Hry3QZL9A3DDT0I_j7xeIbPkMh0Fb6YtcxdSINLzd6xzfXM41yEYHh_ND4WgaFkVH8V_ka5A-GpLybRK_YbViB-M4PLDhHnpavzbVLM9WqElVM1iMwfIcy6dmmrN16W2e' \
-H 'Accept: application/json'

返回的奖杯列表如下：

```
{
   "trophyTitles":[
      {
         "npServiceName":"trophy2",
         "npCommunicationId":"NPWR29948_00",
         "trophySetVersion":"01.00",
         "trophyTitleName":"MONSTER HUNTER RISE",
         "trophyTitleIconUrl":"https://psnobj.prod.dl.playstation.net/psnobj/NPWR29948_00/c2784818-be41-4379-91db-c1fa28ed2593.png",
         "trophyTitlePlatform":"PS5",
         "hasTrophyGroups":true,
         "trophyGroupCount":7,
         "definedTrophies":{
            "bronze":78,
            "silver":15,
            "gold":6,
            "platinum":1
         },
         "progress":4,
         "earnedTrophies":{
            "bronze":6,
            "silver":0,
            "gold":0,
            "platinum":0
         },
         "hiddenFlag":false,
         "lastUpdatedDateTime":"2024-12-29T02:12:23Z"
      },
      {
         "npServiceName":"trophy2",
         "npCommunicationId":"NPWR37356_00",
         "trophySetVersion":"01.00",
         "trophyTitleName":"Stellar Blade",
         "trophyTitleIconUrl":"https://psnobj.prod.dl.playstation.net/psnobj/NPWR37356_00/d1f990db-1929-4092-84dc-4b1c64af872d.png",
         "trophyTitlePlatform":"PS5",
         "hasTrophyGroups":true,
         "trophyGroupCount":2,
         "definedTrophies":{
            "bronze":29,
            "silver":12,
            "gold":3,
            "platinum":1
         },
         "progress":67,
         "earnedTrophies":{
            "bronze":22,
            "silver":10,
            "gold":1,
            "platinum":0
         },
         "hiddenFlag":false,
         "lastUpdatedDateTime":"2024-10-24T14:23:18Z"
      },
      ...
      }
  ],
  "totalItemCount": 100
}
```

可选字段：
limit&offset: pagination可用字段
例：https://m.np.playstation.com/api/trophy/v1/users/USER_ACCOUNT_ID/trophyTitles?limit=20&offset=2

对列表进行一番处理，大致效果如图：  
![showcase](https://res.cloudinary.com/camtrik/image/upload/v1738571894/%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88_2025-02-03_163740_su8fzg.png)  
应用的组件在[这里](https://magicui.design/docs/components/marquee)
